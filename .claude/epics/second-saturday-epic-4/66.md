---
name: Set up Convex schema and core mutations/queries
status: open
created: 2026-02-11T14:26:53Z
updated: 2026-02-12T04:59:28Z
github: https://github.com/SecondSaturday/second-saturday/issues/66
depends_on: [65]
parallel: true
conflicts_with: []
---

# Task: Set up Convex schema and core mutations/queries

## Description
Implement the complete Convex data layer for submissions, including schema definitions for submissions, responses, and media tables, plus all required mutations and queries for creating and managing submission data.

## Acceptance Criteria
- [ ] Submissions table created (circleId, userId, cycleId, submittedAt, lockedAt)
- [ ] Responses table created (submissionId, promptId, text, updatedAt)
- [ ] Media table created (responseId, storageId, muxAssetId, type, thumbnailUrl, order, uploadedAt)
- [ ] createSubmission mutation implemented
- [ ] updateResponse mutation implemented (auto-save support)
- [ ] getSubmissionForCircle query implemented
- [ ] lockSubmission mutation implemented
- [ ] Schema validated with test data
- [ ] All mutations/queries have input validation
- [ ] Proper indexes added for performance

## Technical Details
- Schema location: `convex/schema.ts`
- Mutations location: `convex/submissions.ts`
- Queries location: `convex/submissions.ts`
- Ensure proper foreign key relationships via IDs
- One submission per user per circle per cycle (monthly)
- One response per prompt within a submission
- Support up to 3 media items per response with ordering
- Include createdAt/updatedAt timestamps

## Dependencies
- [ ] Epic 0 (Convex setup) completed
- [ ] Epic 2 (Circles and prompts) schema available
- [ ] Epic 3 (Membership) schema available
- [ ] Design approved (Task 001)

## Effort Estimate
- Size: M
- Hours: 12-16
- Parallel: true (can run parallel with Task 003)

## Definition of Done
- [ ] Schema defined and deployed to Convex
- [ ] All mutations implemented and tested
- [ ] All queries implemented and tested
- [ ] Unit tests written for validation logic (80%+ coverage)
- [ ] Integration tests written for Convex functions
- [ ] Code reviewed and merged
