---
name: Build photo upload with Capacitor Camera and compression
status: in-progress
created: 2026-02-11T14:26:53Z
updated: 2026-02-16T16:23:03Z
github: https://github.com/SecondSaturday/second-saturday/issues/68
depends_on: [66]
parallel: false
conflicts_with: [69]
---

# Task: Build photo upload with Capacitor Camera and compression

## Description
Implement photo upload functionality using Capacitor Camera plugin for mobile camera/gallery access, with client-side image compression to reduce file sizes before uploading to Convex storage.

## Acceptance Criteria
- [x] @capacitor/camera plugin installed and configured
- [x] browser-image-compression library integrated
- [x] MediaUploader component supports photo selection (camera + gallery)
- [x] Photos compress to <200KB client-side (target max 1200px width)
- [x] Compressed photos upload to Convex storage
- [x] Upload progress indicator shown
- [x] Successfully uploaded photos stored in media table
- [ ] Works on iOS and Android devices (device testing pending)
- [x] Error handling for failed uploads/compression
- [x] User can cancel upload in progress

## Technical Details
- Component location: `src/components/submissions/MediaUploader.tsx`
- Use Capacitor Camera for native camera/gallery access
- Compression settings: maxSizeMB: 0.2, maxWidthOrHeight: 1200
- Upload to Convex storage via generateUploadUrl
- Store storageId in media table (linked to responseId)
- Support JPEG and PNG formats
- Show compression/upload progress
- Handle permissions (camera, photo library)

## Dependencies
- [ ] Task 002 (Backend schema) completed
- [ ] Capacitor Camera plugin configured in Epic 0
- [ ] Convex storage configured

## Effort Estimate
- Size: M
- Hours: 10-14
- Parallel: false (conflicts with video upload UI work)

## Definition of Done
- [x] Photo upload working on web
- [ ] Photo upload working on iOS device (device testing pending)
- [ ] Photo upload working on Android device (device testing pending)
- [x] Compression reduces file sizes correctly
- [x] Upload completes in <5 seconds on typical mobile connection
- [x] Unit tests written for compression logic (8 tests, all passing)
- [x] E2E tests written for photo upload flow (9 tests created)
- [ ] Code reviewed and merged

## Latest Progress (2026-02-16)
- âœ… MediaUploader integrated into PromptResponseCard
- âœ… All unit tests passing (14 MediaUploader + 8 compression = 22 tests)
- âœ… E2E tests created (9 comprehensive test scenarios)
- âœ… TypeScript errors fixed in videoActions.ts
- ðŸ”„ Device testing deferred
- ðŸ”„ Awaiting code review and merge
