---
name: Extend schema and create newsletter Convex queries/mutations
status: open
created: 2026-02-21T09:57:44Z
updated: 2026-02-21T10:10:10Z
github: https://github.com/SecondSaturday/second-saturday/issues/93
depends_on: []
parallel: true
conflicts_with: [96]
---

# Task: Extend Schema and Create Newsletter Convex Queries/Mutations

## Description
Extend the existing `newsletters` table in `convex/schema.ts` with content fields needed for compilation and delivery. Add `emailUnsubscribed` field to `memberships` table. Create `convex/newsletters.ts` with all queries and mutations for newsletter CRUD and unsubscribe flow.

## Acceptance Criteria
- [ ] `newsletters` table extended with: `cycleId` (string, YYYY-MM format), `htmlContent` (string), `issueNumber` (number), `recipientCount` (number), `submissionCount` (number), `memberCount` (number)
- [ ] Index added: `by_circle_cycle` on `newsletters` table
- [ ] `memberships` table extended with `emailUnsubscribed` (optional boolean)
- [ ] `getNewsletterById` query created (auth required, membership check)
- [ ] `getNewslettersByCircle` query created (returns archive list, newest first, with read status)
- [ ] `getLatestNewsletter` query created (for a given circleId)
- [ ] `unsubscribeFromEmail` mutation created (sets emailUnsubscribed on membership)
- [ ] `resubscribeToEmail` mutation created (clears emailUnsubscribed)
- [ ] All queries follow existing auth patterns (`getAuthUser`, membership checks)

## Technical Details
- Extend `convex/schema.ts` - add fields to existing `newsletters` table definition
- Add `emailUnsubscribed` optional field to `memberships` table
- Create new `convex/newsletters.ts` file following patterns from `convex/circles.ts` and `convex/submissions.ts`
- Use existing `getAuthUser` helper pattern for auth
- Use `requireMembership()` pattern for access control
- `getNewslettersByCircle` should join with `newsletterReads` to include read status (pattern exists in `circles.ts`)

## Dependencies
- [ ] None - newsletters and newsletterReads tables already exist as shells

## Effort Estimate
- Size: S
- Hours: 3
- Parallel: true

## Definition of Done
- [ ] Schema extended with all new fields
- [ ] All queries/mutations implemented with proper auth
- [ ] TypeScript types compile cleanly
- [ ] Convex dev server runs without errors
