---
name: Write unit tests, integration tests, and E2E tests
status: in-progress
created: 2026-02-21T09:57:44Z
updated: 2026-02-22T05:14:57Z
github: https://github.com/SecondSaturday/second-saturday/issues/100
depends_on: [93, 94, 95, 96, 97, 98]
parallel: false
conflicts_with: []
---

# Task: Write Unit Tests, Integration Tests, and E2E Tests

## Description
Comprehensive test coverage for the newsletter feature: unit tests for business logic, integration tests for Convex functions, and E2E tests for user-facing flows.

## Acceptance Criteria
- [ ] Unit tests (Vitest): newsletter compilation logic
  - [ ] Test organizes responses by prompt correctly
  - [ ] Test omits empty prompts (no responses)
  - [ ] Test member name formatting
  - [ ] Test date formatting in user's local timezone
  - [ ] Test issue number auto-increment
  - [ ] Test 0-submission detection
- [ ] Integration tests (Vitest): Convex functions
  - [ ] Test `compileNewsletter` action with mock submission data
  - [ ] Test `sendNewsletter` action (mock Resend API)
  - [ ] Test `getNewsletterById` query with auth checks
  - [ ] Test `getNewslettersByCircle` query (ordering, read status)
  - [ ] Test unsubscribe/resubscribe mutations
  - [ ] Test newsletter with 0 submissions triggers missed-month flow
- [ ] E2E tests (Playwright): user-facing flows
  - [ ] Test newsletter web view loads with correct content
  - [ ] Test newsletter archive displays past issues
  - [ ] Test newsletter requires authentication
  - [ ] Test "View in App" navigation from email link
  - [ ] Test unsubscribe link functionality
- [ ] 80%+ coverage for newsletter business logic

## Technical Details
- Unit tests: `src/__tests__/newsletter/` or colocated with source
- Integration tests: follow existing Convex testing patterns in the codebase
- E2E tests: add to existing Playwright test suite
- Mock Resend API calls in integration tests (don't send real emails)
- For E2E: seed test data (circle, members, submissions) then trigger compilation
- Use existing test utilities and patterns from the codebase

## Dependencies
- [ ] All implementation tasks (93-99) must be complete

## Effort Estimate
- Size: L
- Hours: 8
- Parallel: false (requires all implementation)

## Definition of Done
- [ ] All unit tests passing
- [ ] All integration tests passing
- [ ] All E2E tests passing
- [ ] 80%+ coverage for business logic
- [ ] No flaky tests
- [ ] Tests run in CI pipeline
