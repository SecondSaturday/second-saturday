---
name: Circle Creation Flow
status: closed
created: 2026-02-09T03:56:28Z
updated: 2026-02-09T04:09:38Z
github: https://github.com/SecondSaturday/second-saturday/issues/46
depends_on: [44]
parallel: true
conflicts_with: []
---

# Task: Circle Creation Flow

## Description

Build the circle creation form with name input, image uploads (icon and cover), and integration with the Convex backend. Images are compressed client-side before upload.

## Acceptance Criteria

- [x] Circle creation accessible from FAB on dashboard
- [x] Form has: name input (required), icon upload (optional), cover upload (optional), description (optional)
- [x] Name validation: 3-50 characters, unique per user
- [x] Icon upload: square aspect ratio, accepts JPG/PNG/HEIC
- [x] Cover upload: 3:1 aspect ratio, accepts JPG/PNG/HEIC
- [x] Images compressed client-side to <200KB before upload
- [x] Image preview shown after selection
- [x] Loading state shown during image compression and upload
- [x] Circle created with 4 default prompts pre-selected
- [x] Invite code auto-generated (UUID)
- [x] Admin's timezone stored from browser
- [x] After creation, user redirected to circle detail or prompt configuration
- [x] Form shows validation errors inline
- [x] Creation completes in under 30 seconds

## Technical Details

### Components to Build

```
src/components/circles/
├── CircleCreationForm.tsx    # Main form component
├── ImageUpload.tsx           # Reusable image upload with compression
└── CircleNameInput.tsx       # Name input with validation
```

### Page Route

- `src/app/(dashboard)/circles/new/page.tsx` - Circle creation page

### Image Compression

Use `browser-image-compression`:
```typescript
import imageCompression from 'browser-image-compression';

const options = {
  maxSizeMB: 0.2, // 200KB
  maxWidthOrHeight: 1024,
  useWebWorker: true,
};
const compressedFile = await imageCompression(file, options);
```

### Convex Integration

- Use `useMutation` for `createCircle`
- Use Convex file storage for images (`generateUploadUrl`, `sendImage`)
- Store image IDs in circle document

### Form State

Consider using react-hook-form or simple useState for form management.

### Analytics Events

- `circle_created` - after successful creation

## Dependencies

- [x] Task 001 (Convex Backend) complete
- [x] npm install browser-image-compression

## Effort Estimate

- Size: M
- Hours: 4-6
- Parallel: true (can run alongside Tasks 45, 47, 005)

## Definition of Done

- [x] Form renders correctly on mobile and desktop
- [x] All validations work (name length, image types)
- [x] Image compression works for JPG, PNG, HEIC
- [x] Images upload to Convex storage
- [x] Circle created in Convex with correct data
- [x] Default prompts created automatically
- [x] User redirected after creation
- [x] Error states handled gracefully
- [x] Analytics event fires on creation
