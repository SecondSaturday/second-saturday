---
name: Write unit, integration, and E2E tests for notifications
status: open
created: 2026-02-22T05:54:13Z
updated: 2026-02-22T06:00:21Z
github: https://github.com/SecondSaturday/second-saturday/issues/110
depends_on: [103, 104, 106, 107, 108]
parallel: false
conflicts_with: []
---

# Task: Write unit, integration, and E2E tests for notifications

## Description
Write comprehensive tests for the notification system covering business logic, Convex functions, and user flows. Target 80%+ coverage for notification business logic.

## Acceptance Criteria
- [ ] Unit tests for notification preference validation and defaults
- [ ] Unit tests for admin reminder count tracking logic (max 3 per cycle)
- [ ] Unit tests for reminder recipient filtering (only non-submitters)
- [ ] Integration tests for `updateNotificationPreferences` mutation
- [ ] Integration tests for `sendAdminReminder` and `sendBulkAdminReminder` mutations
- [ ] Integration tests for `getAdminReminderCount` query
- [ ] Integration tests for reminder count reset after newsletter sends
- [ ] E2E test for notification preferences toggle flow
- [ ] E2E test for admin manual reminder flow (send, count display, max limit)
- [ ] 80%+ test coverage for notification business logic
- [ ] All tests pass in CI

## Technical Details
- Unit tests: Vitest, in `__tests__/` or co-located with source
- Integration tests: Vitest + Convex test helpers (mock OneSignal API calls)
- E2E tests: Playwright, in `e2e/` directory
- Follow existing test patterns from Epic 5 tests
- Mock OneSignal REST API in integration tests (don't send real pushes)
- Test files:
  - `convex/__tests__/notifications.test.ts` — unit + integration for Convex functions
  - `src/components/__tests__/NotificationPreferences.test.tsx` — component tests
  - `src/components/__tests__/AdminSubmissionDashboard.test.tsx` — admin reminder UI tests
  - `e2e/notifications.spec.ts` — E2E flows

## Dependencies
- [ ] Tasks 103, 104, 106, 107, 108 (all implementation tasks must be complete)

## Effort Estimate
- Size: L
- Hours: 8
- Parallel: false
