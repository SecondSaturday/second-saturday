---
name: Implement notification Convex functions
status: open
created: 2026-02-22T05:54:13Z
updated: 2026-02-22T06:00:21Z
github: https://github.com/SecondSaturday/second-saturday/issues/103
depends_on: [102]
parallel: false
conflicts_with: []
---

# Task: Implement notification Convex functions

## Description
Create the core Convex queries, mutations, and actions for the notification system in a new `convex/notifications.ts` file. This includes preference management, push notification sending via OneSignal API, and admin reminder tracking with max 3 per cycle enforcement.

## Acceptance Criteria
- [ ] `getNotificationPreferences` query returns user preferences (with defaults if none set)
- [ ] `updateNotificationPreferences` mutation creates/updates user notification preferences
- [ ] `sendPushNotification` action calls OneSignal REST API to send push to specific player IDs
- [ ] `sendAdminReminder` mutation sends push to individual member, tracks in adminReminders table (Epic 3: 3.5.6)
- [ ] `sendBulkAdminReminder` mutation sends push to all non-submitters, counts as 1 reminder (Epic 3: 3.5.7)
- [ ] `getAdminReminderCount` query returns count of reminders sent this cycle (Epic 3: 3.5.8)
- [ ] Admin reminders enforce max 3 per cycle limit
- [ ] `registerOneSignalPlayerId` mutation stores player ID on users table

## Technical Details
- Create new file: `convex/notifications.ts`
- Use OneSignal REST API v1: POST https://onesignal.com/api/v1/notifications
- Environment variables: `ONESIGNAL_APP_ID`, `ONESIGNAL_REST_API_KEY`
- Follow existing patterns from `convex/newsletters.ts` for action structure
- Use `getNewsletterSendData()` pattern from `convex/newsletterHelpers.ts` for resolving active members
- Non-submitter filtering: query submissions table for current cycle, exclude members who have submitted

## Dependencies
- [ ] Task 102 (schema tables must exist)

## Effort Estimate
- Size: L
- Hours: 8
- Parallel: false
